<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Random Emojis</title>
  <style>
    body {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: white;
      overflow: hidden;
    }

    #center-circle-container {
      position: relative;
      width: 400px;
      height: 400px;
      border-radius: 50%; /* Makes it a perfect circle */
      overflow: hidden;
      background: #f9f9f9; /* light background to see boundary */
    }

    #player-circle-container {
      position: relative;
      width: 400px;
      height: 400px;
      border-radius: 50%; /* Makes it a perfect circle */
      overflow: hidden;
      background: #f9f9f9; /* light background to see boundary */
    }

    .emoji {
      position: absolute;
      transform-origin: center center;
      cursor: pointer;
      transition: transform 0.3s;
    }

    .emoji:hover {
      transform: scale(1.3) rotate(10deg);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

  CENTER PILE
  <div id="center-circle-container"
    style="position: relative; width: 400px; height: 400px; border: 2px solid #ccc; border-radius: 50%; margin: auto; margin-top: 50px;">
    {% for e in center_emojis %}
    <span class="emoji" data-index="{{ e.index }}"
      style="position: absolute; font-size: {{ e.size }}px; transform: rotate({{ e.rotation }}deg);"
      onclick="emojiClicked('{{ e.emoji }}', false)">
      {{ e.emoji }}
    </span>
    {% endfor %}
  </div>

  PLAYER
  <div id="player-circle-container"
    style="position: relative; width: 400px; height: 400px; border: 2px solid #ccc; border-radius: 50%; margin: auto; margin-top: 50px;">
    {% for e in player_emojis %}
    <span class="emoji" data-index="{{ e.index }}"
      style="position: absolute; font-size: {{ e.size }}px; transform: rotate({{ e.rotation }}deg);"
      onclick="emojiClicked('{{ e.emoji }}', true)">
      {{ e.emoji }}
    </span>
    {% endfor %}
  </div>


  <script>
    function arrangeEmojiForAll() {
      arrangeEmoji('player-circle-container');
      arrangeEmoji('center-circle-container');
    }

    function arrangeEmoji(containerId) {
      const container = document.getElementById(containerId);
      const emojis = container.querySelectorAll('.emoji');
      const centerX = container.offsetWidth / 2;
      const centerY = container.offsetHeight / 2;
      const radius = container.offsetWidth / 2 - 60;

      emojis.forEach((emoji) => {
        const index = parseInt(emoji.getAttribute('data-index'));

        if (index === 0) {
          // center emoji
          emoji.style.left = `${centerX - emoji.offsetWidth / 2}px`;
          emoji.style.top = `${centerY - emoji.offsetHeight / 2}px`;
        } else {
          // outer 7 emojis
          let angle = (2 * Math.PI / 7) * (index - 1); // index 1-7
          let x = centerX + radius * Math.cos(angle);
          let y = centerY + radius * Math.sin(angle);

          emoji.style.left = `${x - emoji.offsetWidth / 2}px`;
          emoji.style.top = `${y - emoji.offsetHeight / 2}px`;
        }
      });
    }

    function updateCard(newCenterEmojis, newPlayerEmojis) {
      const centerContainer = document.getElementById('center-circle-container');
      const playerContainer = document.getElementById('player-circle-container');

      // Clear current emojis
      centerContainer.innerHTML = '';
      playerContainer.innerHTML = '';

      // Add new center emojis
      newCenterEmojis.forEach(e => {
        const span = document.createElement('span');
        span.className = 'emoji';
        span.setAttribute('data-index', e.index);
        span.style.fontSize = `${e.size}px`;
        span.style.transform = `rotate(${e.rotation}deg)`;
        span.onclick = () => emojiClicked(e.emoji, false);
        span.innerText = e.emoji;
        centerContainer.appendChild(span);
      });

      // Add new player emojis
      newPlayerEmojis.forEach(e => {
        const span = document.createElement('span');
        span.className = 'emoji';
        span.setAttribute('data-index', e.index);
        span.style.fontSize = `${e.size}px`;
        span.style.transform = `rotate(${e.rotation}deg)`;
        span.onclick = () => emojiClicked(e.emoji, true);
        span.innerText = e.emoji;
        playerContainer.appendChild(span);
      });

      // Re-arrange after adding
      arrangeEmojiForAll();
    }

    function emojiClicked(emoji, isPlayer) {
      addr = isPlayer ? '/clickedPlayer' : '/clickedCenter';
      fetch(addr, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ emoji: emoji })
      })
        .then(response => response.json())
        .then(data => { // for a nice popup message
          if (data && data.message) {
            Swal.fire({
              toast: true,
              position: 'top',
              showConfirmButton: false,
              timer: 3000,
              timerProgressBar: true,
              icon: 'info',
              title: data.message
            });
          }
          if (data && data.center_emojis && data.player_emojis) {
            console.log('UPDATING')
            updateCard(data.center_emojis, data.player_emojis);
          }
        });
    }

    // Arrange the emojis once the page loads
    window.onload = arrangeEmojiForAll;
  </script>

</body>

</html>